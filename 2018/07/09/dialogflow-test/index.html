<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo32.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo16.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="dialogflow,机器人," />










<meta name="description" content="现在无论是在线购买商品或咨询问题，对话机器人或者说智能客服已经成为了不可或缺的部分，仅论量的话“人机”交互早已超过了“人人”交互。而对话式交互更加接近现实，提升查询交互体验的同时为营销等场景提供了更加精确的服务入口。虽然国内巨头都有相应产品，但你会发现他们的网站重在阐述我家产品很牛，如果想了解一些基本概念有所收获的话，推荐谷大爷的dailogflow。这个网站竟然需要科学上网 - - ||下文主要">
<meta name="keywords" content="dialogflow,机器人">
<meta property="og:type" content="article">
<meta property="og:title" content="dialogflow.com 试玩报告">
<meta property="og:url" content="http://www.wangwj.top/2018/07/09/dialogflow-test/index.html">
<meta property="og:site_name" content="老王的编程教室">
<meta property="og:description" content="现在无论是在线购买商品或咨询问题，对话机器人或者说智能客服已经成为了不可或缺的部分，仅论量的话“人机”交互早已超过了“人人”交互。而对话式交互更加接近现实，提升查询交互体验的同时为营销等场景提供了更加精确的服务入口。虽然国内巨头都有相应产品，但你会发现他们的网站重在阐述我家产品很牛，如果想了解一些基本概念有所收获的话，推荐谷大爷的dailogflow。这个网站竟然需要科学上网 - - ||下文主要">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-10865d736c8d1b62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-fe0a4d8aa88c819f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-af761be3ab2039eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-8282d6937e3d9199.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-77430a4586d60423.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-bb8f74f7772bc203.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-53a554ae2027ea4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-5c85265d632a20fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-c30814460aca6b6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-d0a34aa03cbf0821.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-72a8d3610afed86e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/3789580-f8a95537534737e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2018-07-09T11:41:53.029Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dialogflow.com 试玩报告">
<meta name="twitter:description" content="现在无论是在线购买商品或咨询问题，对话机器人或者说智能客服已经成为了不可或缺的部分，仅论量的话“人机”交互早已超过了“人人”交互。而对话式交互更加接近现实，提升查询交互体验的同时为营销等场景提供了更加精确的服务入口。虽然国内巨头都有相应产品，但你会发现他们的网站重在阐述我家产品很牛，如果想了解一些基本概念有所收获的话，推荐谷大爷的dailogflow。这个网站竟然需要科学上网 - - ||下文主要">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/3789580-10865d736c8d1b62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://www.wangwj.top/2018/07/09/dialogflow-test/"/>





  <title>dialogflow.com 试玩报告 | 老王的编程教室</title>
  





  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?5ab6497d6b73e1981e94fd5f91879173";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">老王的编程教室</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">欢迎留言</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://www.wangwj.top/2018/07/09/dialogflow-test/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="老王">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="老王的编程教室">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">dialogflow.com 试玩报告</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-07-09T10:09:41+08:00">
                2018-07-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/技术杂记/" itemprop="url" rel="index">
                    <span itemprop="name">技术杂记</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-comment-o"></i>
              </span>
              
                <a href="/2018/07/09/dialogflow-test/#SOHUCS" itemprop="discussionUrl">
                  <span id="changyan_count_unit" class="post-comments-count hc-comment-count" data-xid="2018/07/09/dialogflow-test/" itemprop="commentsCount"></span>
                </a>
              
            
          

          
          
             <span id="/2018/07/09/dialogflow-test/" class="leancloud_visitors" data-flag-title="dialogflow.com 试玩报告">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>现在无论是在线购买商品或咨询问题，对话机器人或者说智能客服已经成为了不可或缺的部分，仅论量的话“人机”交互早已超过了“人人”交互。而对话式交互更加接近现实，提升查询交互体验的同时为营销等场景提供了更加精确的服务入口。虽然国内巨头都有相应产品，但你会发现他们的网站重在阐述我家产品很牛，如果想了解一些基本概念有所收获的话，推荐谷大爷的dailogflow。这个网站竟然需要科学上网 - - ||<br>下文主要根据网站的文档了解概念并依据示例实践一些基本功能，如果你感兴趣，又不方便翻墙，花几分钟看下本文就能有个简单的了解，如果有“条件”，看完之后建议自己玩一下更加深刻。<br>下面简介内容来自官方英文文档，英文好的话可以忽略我的中文翻译，中文括号为补充说明。</p>
<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>The process a Dialogflow agent follows from invocation to fulfillment is similar to someone answering a question, with some liberties taken of course. In the example scenario below, the same question is being asked, but we compare the “human to human” interaction with a conversation with an Dialogflow agent.<br>Dialogflow agent（对话代理）调用流程和同某人自由问答类似。如同下面给出的例子，基于一个同样的问题，比较真实情况下人们之间的对话与对话代理之间的区别。</p>
<h5 id="Welcome-欢迎-开场白"><a href="#Welcome-欢迎-开场白" class="headerlink" title="Welcome 欢迎/开场白"></a>Welcome 欢迎/开场白</h5><p>Bill’s friend Harry wants to ask him a question. So as not to be rude, Harry says “Hello” to Bill first.<br>张三的朋友李四想问他一个问题，为了不失礼貌最好先打个招呼，“你好”。（所以同样的，对话代理也需要设定一个开场白来回复用户，例如用户说你好的时候回复“有什么可以帮到您？”）</p>
<h5 id="Invocation-调用"><a href="#Invocation-调用" class="headerlink" title="Invocation 调用"></a>Invocation 调用</h5><p>In order to start a conversation with an agent, the user needs to invoke the agent. A user does this by asking to speak with the agent in a manner specified by the agent’s developer.<br>为了进行人机对话，用户需要先启动一个对应代理。用户通过代理开发人员提供的特定流程进行对话。（用户在开发人员提供的应用场景内触发机器对话）</p>
<h5 id="Request-提问"><a href="#Request-提问" class="headerlink" title="Request 提问"></a>Request 提问</h5><p>Harry asks Bill “What’s the weather supposed to be like in San Francisco tomorrow?” Because Bill is familiar with the city and the concept of weather, he knows what Harry is asking for.<br>李四问张三：“明天旧金山天气怎么样”，因为张三更加熟悉这座城市和天气方面的知识，他知道怎么回答李四。</p>
<h5 id="Intent-意图"><a href="#Intent-意图" class="headerlink" title="Intent 意图"></a>Intent 意图</h5><p>A user asks the agent “What’s the weather supposed to be like in San Francisco tomorrow?” In Dialogflow, an intent houses elements and logic to parse information from the user and answer their requests.<br>在Dialogflow中，当用户问旧金山明天天气怎么样时，一个意图相关元素和逻辑会识别用户提问和回答对应问题。（Dialogflow 理解问题的方式是从对话信息中获得用户的意图）</p>
<h5 id="User-says-用户可能会这么问"><a href="#User-says-用户可能会这么问" class="headerlink" title="User says 用户可能会这么问"></a>User says 用户可能会这么问</h5><p>For the agent to understand the question, it needs examples of how the same question can be asked in different ways. Developers add these permutations to the User Says section of the intent. The more variations added to the intent, the better the agent will comprehend the user.<br>为了让对话代理理解用户提出的问题，需要先给出同样问题用户可能会提问的方式。开发人员添加用户说话方式组合到对应的意图中。添加的例子越多，对话代理就越能理解用户。（Dialogflow需要预设一些谈话例子，在此基础上通过技术手段把问题“扩展”，当用户提问不完全与例子相同也能判断出其实是一个问题）</p>
<h5 id="Entities-实体"><a href="#Entities-实体" class="headerlink" title="Entities 实体"></a>Entities 实体</h5><p>The Dialogflow agent needs to know what information is useful for answering the user’s request. These pieces of data are called entities. Entities like time, date, and numbers are covered by system entities. Other entities, like weather conditions or seasonal clothing, need to be defined by the developer so they can be recognized as an important part of the question.<br>对话代理需要知道用户提问中的关键信息，这些数据被定义为实体：例如时间，日期以及很多系统自带实体；还包括例如天气条件，季节性穿着，还有需要由开发人员自定义的实体信息以便系统能识别为关键信息。（如果觉得实体这俩个字比较抽象，可以近似的理解为关键词，或者同义词）</p>
<h5 id="Fulfillment-实现（场景）"><a href="#Fulfillment-实现（场景）" class="headerlink" title="Fulfillment 实现（场景）"></a>Fulfillment 实现（场景）</h5><p>Armed with the information Bill needs, he searches for the answer using his favorite weather provider. He enters the location and time to get the results he needs.<br>李四使用他最喜欢的能提供他所需信息的天气应用，通过输入地点和时间获得他所需的结果。</p>
<h5 id="Fulfillment-Request-实现请求"><a href="#Fulfillment-Request-实现请求" class="headerlink" title="Fulfillment Request 实现请求"></a>Fulfillment Request 实现请求</h5><p>Dialogflow sends this information to your webhook, which subsequently fetches the data needed (per your development). Your webhook parses that data, determines how it would like to respond, and sends it back to Dialogflow<br>Dialogflow向你开发的web服务接口发送信息，获得所需信息，该接口用来解析请求并将答复返回给Dialogflow（Dialogflow 分析出意图，然后根据开发人员针对该意图预设的操作调用相应的接口，最后向用户展示答复）</p>
<h5 id="Response-“人类对话答复”"><a href="#Response-“人类对话答复”" class="headerlink" title="Response “人类对话答复”"></a>Response “人类对话答复”</h5><p>After scanning the page for the relevant info, Bill tells Harry “It looks like it’s going to be 65 and overcast tomorrow.”<br>张三在查询过相关网站后，回答李四：“明天温度为18度左右，阴天”</p>
<h5 id="Response-“Dialogflow对话答复”"><a href="#Response-“Dialogflow对话答复”" class="headerlink" title="Response “Dialogflow对话答复”"></a>Response “Dialogflow对话答复”</h5><p>With the formatted reply “in hand”, Dialogflow delivers the response to your user. “It looks like it’s going to be 65 and overcast tomorrow.”<br>通过格式化现有回复数据（例如通过上面提到的web服务接口获得数据），Dialogflow推送答复给用户：“明天温度为18度左右，阴天”。</p>
<h5 id="Context-“人类对话上下文”"><a href="#Context-“人类对话上下文”" class="headerlink" title="Context “人类对话上下文”"></a>Context “人类对话上下文”</h5><p>Now that the conversation is on the topic of weather, Bill won’t be thrown off if Harry asks “How about the day after that?” Because Harry had asked about San Francisco, follow up questions will more than likely be about the same city, unless Harry specifies a new one.<br>现在谈话的主题是天气，当张三继续提问“那后天呢？” ，李四会认为他还想知道当前讨论城市旧金山后天的天气，除非张三在提问中特指了新的。</p>
<h5 id="Context-“Dialogflow对话上下文”"><a href="#Context-“Dialogflow对话上下文”" class="headerlink" title="Context “Dialogflow对话上下文”"></a>Context “Dialogflow对话上下文”</h5><p>Similar to Bill’s scenario, context can be used to keep parameter values, from one intent to another. Contexts are also used to repair a conversation that has been broken by a user or system error, as well as branch conversations to different intents, depending on the user’s response.<br>同人类间对话类似，Dialogflow对话保存上下文参数，即使从当前意图转化为另一个意图。上下文也经常用来修复对话中断和系统异常，或者根据用户的回复切换到不同的意图场景，。<br>（中断场景例如今天问了旧金山天气，即使过几天再来问“天气咋样？”，也能根据之前的对话上下文判断是在问旧金山的天气）</p>
<h4 id="光说不练假把式"><a href="#光说不练假把式" class="headerlink" title="光说不练假把式"></a>光说不练假把式</h4><p>参考文档创建一个天气对话代理。<br>新建agent 输入名字 weatherAgent ,选择语言为英语 。然后点创建<br><img src="http://upload-images.jianshu.io/upload_images/3789580-10865d736c8d1b62.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>然后你会进入该代理的控制台：<br><img src="http://upload-images.jianshu.io/upload_images/3789580-fe0a4d8aa88c819f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>点击创建意图<br>在User says 输入框内输入 “Weather forecast in San Francisco tomorrow “<br>此处注意一个特殊操作，当你选择语句的一段时会弹框出参数配置，可以根据过滤器（fliter）输入框检索出你需要的那个参数<br><img src="http://upload-images.jianshu.io/upload_images/3789580-af761be3ab2039eb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>下面是配置好的样子<br><img src="http://upload-images.jianshu.io/upload_images/3789580-8282d6937e3d9199.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>添加意图对应的回复，在Response中添加语句：“I don’t kown the weather for $date and  $geo-city”，注意输入$时会如下面所示弹出下拉框给你选择。<br><img src="http://upload-images.jianshu.io/upload_images/3789580-77430a4586d60423.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>点击右上角的保存按钮后来试试生效了没，在最右上角的“try it now”中输入刚才你保存的用户问句。<br><img src="http://upload-images.jianshu.io/upload_images/3789580-bb8f74f7772bc203.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>可以看到生效了，不仅回答了我问题，还把参数部分替换为我的问句内容，当前提问时间是1月7日，但问的问题是明天，所以date部分为1月8日。<br>让我们来考考它，换一个说法：“How about the weather in San Francisco tomorrow”<br><img src="http://upload-images.jianshu.io/upload_images/3789580-53a554ae2027ea4a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>可以看到上图所示，还是分析出来了，66666<br>可以尝试问下周的天气：Weather forecast in San Francisco one week later ，类似问题也同样能解析出对应的时期：<br><img src="http://upload-images.jianshu.io/upload_images/3789580-5c85265d632a20fb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>接下来创建一个实体，配置一个和天气–Weather同义的词<br><img src="http://upload-images.jianshu.io/upload_images/3789580-c30814460aca6b6e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>如上图，先输入weather 然后在当前行继续输入“tianqi” ，可以追加输入数个随意单词作为同义词。点击保存，试一下：<br><img src="http://upload-images.jianshu.io/upload_images/3789580-d0a34aa03cbf0821.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>生效了～<br>最后再提一下Integrations-集成功能，在集成配置中开启Web Demo开关：<br><img src="http://upload-images.jianshu.io/upload_images/3789580-72a8d3610afed86e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>浏览器打开提示链接<a href="https://bot.dialogflow.com/X(X二级地址可以自定义)" target="_blank" rel="noopener">https://bot.dialogflow.com/X(X二级地址可以自定义)</a><br><img src="http://upload-images.jianshu.io/upload_images/3789580-f8a95537534737e0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"><br>怎么样，很方便吧？</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>Dialogflow通过极简的方式提供了很多强大的功能，例如官方文档详细说明的如何通过自定义接口接受意图并返回答复，以及各类客户端集成办法，还有不断新增的识别训练等功能。<br>比较遗憾的是虽然提供了看似挺丰富的中文语言选项（简体，繁体，粤语/HK），但支持的不是很好，没有实现英文的用户问答那样配置一个例子，能扩展识别多种问法，所以示例用了英文，相信未来会逐步支持。<br>本文中仅仅叙述了平台几个功能，用它能实现的交互场景太多太多。欢迎大家提供看法一起讨论，以及提出本文错漏的部分。感谢你的阅读。</p>

      
    </div>
    
    
    

    

    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>坚持原创分享，您的支持将鼓励我继续创作！</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="老王 微信支付"/>
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="老王 支付宝"/>
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/dialogflow/" rel="tag"># dialogflow</a>
          
            <a href="/tags/机器人/" rel="tag"># 机器人</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/07/09/jenkins-spring/" rel="next" title="linux环境下使用docker：jenkins对spring boot工程进行部署">
                <i class="fa fa-chevron-left"></i> linux环境下使用docker：jenkins对spring boot工程进行部署
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/07/09/scratch-edu-2/" rel="prev" title="老王教你学编程 scratch初级-2-穿越迷宫">
                老王教你学编程 scratch初级-2-穿越迷宫 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
        
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="SOHUCS"></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">老王</p>
              <p class="site-description motion-element" itemprop="description">层楼终究误少年,自由早晚乱余生。</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">7</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-4"><a class="nav-link" href="#简介"><span class="nav-number">1.</span> <span class="nav-text">简介</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Welcome-欢迎-开场白"><span class="nav-number">1.1.</span> <span class="nav-text">Welcome 欢迎/开场白</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Invocation-调用"><span class="nav-number">1.2.</span> <span class="nav-text">Invocation 调用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Request-提问"><span class="nav-number">1.3.</span> <span class="nav-text">Request 提问</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Intent-意图"><span class="nav-number">1.4.</span> <span class="nav-text">Intent 意图</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#User-says-用户可能会这么问"><span class="nav-number">1.5.</span> <span class="nav-text">User says 用户可能会这么问</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Entities-实体"><span class="nav-number">1.6.</span> <span class="nav-text">Entities 实体</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Fulfillment-实现（场景）"><span class="nav-number">1.7.</span> <span class="nav-text">Fulfillment 实现（场景）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Fulfillment-Request-实现请求"><span class="nav-number">1.8.</span> <span class="nav-text">Fulfillment Request 实现请求</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Response-“人类对话答复”"><span class="nav-number">1.9.</span> <span class="nav-text">Response “人类对话答复”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Response-“Dialogflow对话答复”"><span class="nav-number">1.10.</span> <span class="nav-text">Response “Dialogflow对话答复”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Context-“人类对话上下文”"><span class="nav-number">1.11.</span> <span class="nav-text">Context “人类对话上下文”</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Context-“Dialogflow对话上下文”"><span class="nav-number">1.12.</span> <span class="nav-text">Context “Dialogflow对话上下文”</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#光说不练假把式"><span class="nav-number">2.</span> <span class="nav-text">光说不练假把式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#总结"><span class="nav-number">3.</span> <span class="nav-text">总结</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">wangwj</span>

  
</div>









        
<div class="busuanzi-count">
  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv">
      <i class="fa fa-user"></i> 访问人数
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
      
    </span>
  

  
    <span class="site-pv">
      <i class="fa fa-eye"></i> 总访问量
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
      次
    </span>
  
</div>








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  




  
    <script type="text/javascript">
    (function(){
      var appid = 'cytHfIp4z';
      var conf = '4266dd7bf862fcf743b60091ef0377e5';
      var width = window.innerWidth || document.documentElement.clientWidth;
      if (width < 960) {
      window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){
        window.changyan.api.config({appid:appid,conf:conf})});
      }
    })();
    </script>
    <script type="text/javascript" src="https://assets.changyan.sohu.com/upload/plugins/plugins.count.js"></script>
  









  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("JJorq9BQcjbP7EETAjHXxX29-gzGzoHsz", "KHrsqAeQKax0D4VNac10Fc4r");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
